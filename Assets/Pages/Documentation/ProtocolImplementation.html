<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>CS35/15 Documentation - Protocol</title>
    <link rel="stylesheet" type="text/css" href="../Resources/Styles/docs.css" />
    <link rel="stylesheet" type="text/css" href="../Resources/Styles/syntax-highlight.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="../Resources/Scripts/syntax-highlight.js"></script>
</head>
<body>
    <h1>CS35/15 Documentation - Protocol</h1>
    The <code>Protocol</code> class provides details and methods relating to the implementation of Chat Server Protocol.
    Current version is 1.0, or can be found as <code>public static const string PROTOCOL_VERSION</code> in the class.

    <h2>100 Series: Connections</h2>
    The headers in this series provide information about the connection between client and server.<br /><br />

    <strong id="100-Initiate" class="unused"><a href="#100-Initiate">100 Initiate</a></strong>
    <p>Sent from the client, used to notify the server that a client wants to connect. Used as first-contact verification that
    both client and server are legitimate. <em>Server response: <a href="#202-Continue">202 Continue</a></em></p>

    <strong id="101-Successful-Connection"><a href="#101-Successful-Connection">101 Successful Connection</a></strong>
    <p>Used by the server to inform the client that it has successfully authenticated and is listed as a connected client.
        <em>No response required</em></p>

    <strong id="102-Failed-Connection" class="unused"><a href="#102-Failed-Connection">102 Failed Connection</a></strong>
    <p>Used by the server to inform the client that <i>something</i> about its connection request went wrong. <em>No
        response required</em></p>

    <strong id="103-Dropping-Connection" class="unused"><a href="#103-Dropping-Connection">103 Dropping Connection</a></strong>
    <p>Used by the server to tell the client that its connection must be forcibly closed, due to a recoverable server 
        problem. <em>No response required</em></p>

    <strong id="104-Server-Shutdown"><a href="#104-Server-Shutdown">104 Server Shutdown</a></strong>
    <p>Used by the server to inform all clients that the server is shutting down. No further communications will be 
        processed. <em>No response required</em></p>

    <strong id="105-Kicked" class="unused"><a href="#105-Kicked">105 Kicked</a></strong>
    <p>Used by the server to tell the client that its user has been kicked from the network by a moderator or administrator. The
        kicked user may reconnect. Similar results to <a href="#103-Dropping-Connection">103 Dropping Connection</a>, but with the
        additional information about why the drop has occurred. <em>No response required</em></p>

    <strong id="106-Banned" class="unused"><a href="#106-Banned">106 Banned</a></strong>
    <p>Used by the server to tell the client that its user has been permanently banned from the network by a moderator or
        administrator. The banned user will be denied further connections. Similar results to 
        <a href="#103-Dropping-Connection">103 Dropping Connection</a>, but with the additional information about why the drop 
        has occurred. <em>No response required</em></p>

    <hr class="small" />

    <h2>200 Series: Confirmations</h2>
    This series provides the ability for either party to confirm receipt of a message, without responding directly to it.<br /><br />

    <strong id="200-OK" class="unused"><a href="#200-OK">200 OK</a></strong>
    <p>A generic confirmation or affirmation, used by either party to respond to a message without providing additional detail.
        <em>No response required</em></p>

    <strong id="201-Received"><a href="#201-Received">201 Received</a></strong>
    <p>Used by the server to indicate to a client that its message has been received and sent round to all connected clients.
        <em>No response required</em></p>

    <strong id="202-Continue"><a href="#202-Continue">202 Continue</a></strong>
    <p>Used by either party to indicate that a partial communication has been received, but more is expected. <em>Response:
        continuation of communication</em></p>

    <hr class="small" />

    <h2>300 Series: From Client</h2>
    These headers are intended to be exclusively used by the client. For that reason, the using party is not identified in the 
    descriptions below.<br /><br />

    <strong id="300-Response"><a href="#300-Response">300 Response</a></strong>
    <p>Notifies of a response to an earlier question, such as a <a href="#202-Continue">202 Continue</a> request. A linebreak 
        (<code>\n</code>) will be succeeded by the response text. <em>Response requirements vary</em></p>

    <strong id="301-Disconnecting"><a href="#301-Disconnecting">301 Disconnecting</a></strong>
    <p>Informs the server that this client is shutting down and will not be sending any more communications, and thus that
        the server can safely remove the client from the connected list and stop any threads listening to it. <em>No response
        required</em></p>

    <strong id="302-Message"><a href="#302-Message">302 Message</a></strong>
    <p>Precedes a text message for the server to send to all connected clients. A linebreak will denote the start of the 
        message. <em>Server response: <a href="#201-Received">201 Received</a> when sending complete</em></p>

    <hr class="small" />

    <h2>400 Series: Client Errors</h2>
    This series details mistakes made by the client, and enables the server to respond to a communication simply by informing
    the client of its mistake. No response is <em>required</em> for any of these, but the client may repeat its request having
    fixed the error.<br /><br />

    <strong id="400-Bad-Request"><a href="#400-Bad-Request">400 Bad Request</a></strong>
    <p>Indicates that the request from the client was invalid in some way: could not be parsed, had an incorrect format, etc.
        <em>No response required</em></p>

    <strong id="401-Username-Expected"><a href="#401-Username-Expected">401 Username Expected</a></strong>
    <p>Intended solely as a response to a connection attempt. 401 is sent when the client's response to <a href="#202-Continue">
        202 Continue</a> in the authentication process does not match the expected format, i.e. a username. <em>No response
        required</em></p>

    <strong id="402-Response-Expected" class="unused"><a href="#402-Response-Expected">402 Response Expected</a></strong>
    <p>A more general version of <a href="#401-Username-Expected">401 Username Expected</a>, indicates that the client did not
        send a response to a request for more information, where that information was expected. <em>No response required</em></p>

    <strong id="403-Bad-Format"><a href="#403-Bad-Format">403 Bad Format</a></strong>
    <p>Indicates that the communication received was not in any expected format. This usually means that no CSP header was
        present. <em>No response required</em></p>

    <strong id="404-No-Question"><a href="#404-No-Question">404 No Question</a></strong>
    <p>The opposite of <a href="#402-Response-Expected">402 Response Expected</a>. Indicates that the client sent some information
        when none was expected. <em>No response required</em></p>

    <hr class="small" />

    <h2>500 Series: Server Errors</h2>
    This series is the counterpart to the 400 Series (Client Errors). It indicates that the server encountered an error when serving
    a message or request.<br/><br />

    <strong id="500-Server-Error"><a href="#500-Server-Error">500 Server Error</a></strong>
    <p>Indicates that the server encountered an error and has had to drop the current request. Any data contained within that
        request has not been recovered. <em>Optional client response: repeat request</em></p>

    <hr />

    <h2 id="Protocol-Format">Protocol Format</h2>
    Requests to a CSP server should follow the general format:

    <pre class="text">CSP/[version] [header] [header desc]</pre>

    Fields in [square brackets] should be substituted for the appropriate values:

    <ul>
        <li><code>[version]</code> is a <code>string</code> representation of the CSP version. This can be found in the 
            <code>Protocol</code> class as <code>public static const string PROTOCOL_VERSION</code>.</li>
        <li><code>[header]</code> is an <code>int</code> in string form, containing the <em>number</em> of the header being sent.</li>
        <li><code>[header desc]</code> is a <code>string</code>, containing the description of the header. This can be found in
            the above header lists.</li>
    </ul>

    For some headers, like <a href="#300-Response">300 Response</a> and <a href="#302-Message">302 Message</a>, the full request
    also needs to contain other details specific to the request. These should be added <em>after</em> the CSP header and a linebreak (<code>\n</code>):

    <pre class="text">CSP/1.0 302 Message
some message text goes in here</pre>

    It may be a wise idea, if one does not already exist, to construct a method to get a full response string for a specific code.
    There is a dictionary in the <code>Protocol</code> class which can be used to look up header descriptions for each code. Such a
    method might look like this:

    <pre class="c-sharp">public static string GetResponseString(int code)
{
    string desc = StatusCodes.ContainsKey(code) ? StatusCodes[code] : null;
    if(desc != null) 
    {
        return string.Format("CSP/{0} {1} {2}", Protocol.PROTOCOL_VERSION, code, desc);
    }
    else
    {
        throw new InvalidStatusException("The specified response code does not exist.");
    }
}</pre>


    <script>
        $("pre.text").snippet("html", { style: "ide-msvcpp", menu: false });
        $("pre.c-sharp").snippet("csharp", { style: "ide-msvcpp", menu: false });
    </script>
    <script>
        var hash = location.hash;
        if (location.hash && location.hash != "") {
            $(location.hash).css("background", "rgb(255, 255, 125)");
            hash = location.hash;
        }
        $(window).on("hashchange", function () {
            $(location.hash).css("background", "rgb(255, 255, 125)");
            $(hash).css("background", "white");
            hash = location.hash;
        });
    </script>
</body>
</html>